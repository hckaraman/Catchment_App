<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">
        <head>
            <meta content=\"text/html; charset=iso-8859-1\" http-equiv=\"content-type\">
            <title>Hypsometric Analysis</title><style type="text/css">
            h1 {
                font-size: 14pt;
                margin-left: 15px;
                margin-right: 15px;
                text-align: center;
                font-family: Helvetica, Verdana, Geneva, Arial, sans-serif;
            }
            h2 {
                font-size: 12pt;
                margin-left: 15px;
                margin-right: 15px;
                text-align: center;
                font-family: Helvetica, Verdana, Geneva, Arial, sans-serif;
            }
            p {
                font-size: 12pt;
                font-family: Helvetica, Verdana, Geneva, Arial, sans-serif;
                margin-left: 15px;
                margin-right: 15px;
            }
            caption {
                font-family: Helvetica, Verdana, Geneva, Arial, sans-serif;
                font-size: 12pt;
                margin-left: 15px;
                margin-right: 15px;
            }
            table {
                font-size: 12pt;
                font-family: Helvetica, Verdana, Geneva, Arial, sans-serif;
                font-family: arial, sans-serif;
                border-collapse: collapse;
                align: center;
            }
            td, th {
                border: 1px solid #222222;
                text-align: centre;
                padding: 8px;
            }
            tr:nth-child(even) {
                background-color: #dddddd;
            }
            tr:hover {
                background-color: lightyellow;
            }
            .numberCell {
                text-align: right;
            }
            .header {
                font-weight: bold;
                text-align: center;
            }
        </style></head>
        <body>
            <h1>Hypsometric Analysis</h1><p><strong>Input DEM</strong>: DEM_watershed</p><div id='graph' align="center">
    <script>
      var plot = {
        dataX: [[99.93382961124897, 99.76840363937139, 99.66914805624482, 99.48717948717949, 99.27212572373863, 99.0074441687345, 98.7262200165426, 98.3291976840364, 98.03143093465674, 97.48552522746071, 97.12158808933002, 96.64185277088502, 96.04631927212573, 95.00413564929694, 94.19354838709677, 93.33333333333333, 92.75434243176178, 92.15880893300248, 91.54673283705542, 90.93465674110836, 90.14061207609595, 89.46236559139786, 88.6021505376344, 87.51033912324235, 86.36889991728701, 85.2605459057072, 84.3010752688172, 83.29197684036393, 82.23325062034739, 81.25723738626964, 80.46319272125724, 79.63606286186932, 79.07361455748553, 78.41191066997519, 77.73366418527708, 77.07196029776675, 76.57568238213399, 75.98014888337468, 75.26881720430107, 74.57402812241523, 73.61455748552524, 73.13482216708023, 72.19189412737799, 71.57981803143095, 70.80231596360629, 70.2398676592225, 69.46236559139784, 68.767576509512, 68.0066170388751, 67.37799834574028, 66.61703887510339, 65.92224979321753, 65.19437551695616, 64.20181968569065, 63.68899917287014, 62.878411910669975, 62.0347394540943, 61.12489660876758, 60.215053763440864, 59.354838709677416, 58.54425144747726, 57.71712158808933, 56.80727874276261, 55.88089330024815, 54.64019851116626, 53.89578163771712, 52.870140612076085, 51.943755169561626, 51.199338296112494, 50.47146401985112, 49.39619520264682, 48.6848635235732, 47.526881720430104, 46.4516129032258, 45.92224979321754, 44.84698097601323, 43.87096774193549, 42.812241521918935, 41.90239867659222, 41.02564102564102, 40.0827129859388, 38.858560794044664, 37.61786600496278, 36.27791563275434, 34.971050454921425, 34.011579818031436, 32.88668320926386, 31.76178660049628, 30.554177005789906, 29.44582299421009, 28.07278742762613, 27.311827956989244, 26.501240694789086, 25.39288668320926, 24.367245657568237, 23.093465674110835, 22.448304383788255, 21.85277088502895, 21.124896608767575, 20.23159636062862, 19.751861042183627, 19.20595533498759, 18.593879239040533, 17.81637717121588, 17.30355665839537, 16.542597187758478, 15.897435897435896, 15.053763440860212, 14.094292803970221, 13.300248138957816, 12.837055417700583, 12.208436724565752, 11.62944582299421, 11.248966087675761, 10.521091811414395, 10.024813895781637, 9.47890818858561, 8.866832092638543, 8.453267162944577, 8.155500413564932, 7.890818858560788, 7.361455748552526, 6.964433416046322, 6.236559139784948, 5.740281224152188, 5.376344086021501, 5.012406947890824, 4.582299421009095, 4.267990074441686, 3.970223325062039, 3.6724565756823813, 3.3085194375516935, 2.928039702233254, 2.613730355665844, 2.3655913978494647, 2.100909842845322, 1.9354838709677469, 1.7038875103391193, 1.4061207609594728, 1.1248966087675782, 0.8602150537634357, 0.8105872622001686, 0.6286186931348192, 0.5293631100082741, 0.3143093465674096, 0.18196856906533831, 0.11579818031430822, 0.08271298593879317, 0.08271298593879317, 0.08271298593879317, 0.016542597187763075, 0.016542597187763075, 0.016542597187763075, 0.0001]],
        dataY: [[1035.0, 1040.0194805844155, 1045.038961168831, 1050.0584417532468, 1055.0779223376624, 1060.097402922078, 1065.1168835064934, 1070.1363640909092, 1075.1558446753247, 1080.1753252597402, 1085.1948058441558, 1090.2142864285715, 1095.233767012987, 1100.2532475974026, 1105.2727281818181, 1110.2922087662337, 1115.3116893506494, 1120.331169935065, 1125.3506505194805, 1130.370131103896, 1135.3896116883116, 1140.4090922727273, 1145.4285728571429, 1150.4480534415584, 1155.467534025974, 1160.4870146103897, 1165.5064951948052, 1170.5259757792207, 1175.5454563636363, 1180.564936948052, 1185.5844175324676, 1190.603898116883, 1195.6233787012986, 1200.6428592857142, 1205.66233987013, 1210.6818204545455, 1215.701301038961, 1220.7207816233765, 1225.7402622077923, 1230.7597427922078, 1235.7792233766233, 1240.7987039610389, 1245.8181845454546, 1250.8376651298702, 1255.8571457142857, 1260.8766262987012, 1265.8961068831168, 1270.9155874675325, 1275.935068051948, 1280.9545486363636, 1285.9740292207791, 1290.9935098051947, 1296.0129903896104, 1301.032470974026, 1306.0519515584415, 1311.0714321428572, 1316.0909127272728, 1321.1103933116883, 1326.1298738961038, 1331.1493544805194, 1336.1688350649351, 1341.1883156493507, 1346.2077962337662, 1351.2272768181817, 1356.2467574025973, 1361.266237987013, 1366.2857185714286, 1371.305199155844, 1376.3246797402599, 1381.3441603246754, 1386.363640909091, 1391.3831214935065, 1396.402602077922, 1401.4220826623377, 1406.4415632467533, 1411.4610438311688, 1416.4805244155843, 1421.5000049999999, 1426.5194855844156, 1431.5389661688312, 1436.5584467532467, 1441.5779273376622, 1446.5974079220778, 1451.6168885064935, 1456.636369090909, 1461.6558496753246, 1466.6753302597403, 1471.6948108441559, 1476.7142914285714, 1481.733772012987, 1486.7532525974025, 1491.7727331818182, 1496.7922137662338, 1501.8116943506493, 1506.8311749350648, 1511.8506555194804, 1516.8701361038961, 1521.8896166883117, 1526.9090972727272, 1531.928577857143, 1536.9480584415585, 1541.967539025974, 1546.9870196103896, 1552.006500194805, 1557.0259807792208, 1562.0454613636364, 1567.064941948052, 1572.0844225324674, 1577.103903116883, 1582.1233837012987, 1587.1428642857143, 1592.1623448701298, 1597.1818254545456, 1602.2013060389609, 1607.2207866233766, 1612.2402672077922, 1617.2597477922077, 1622.2792283766235, 1627.2987089610388, 1632.3181895454545, 1637.33767012987, 1642.3571507142856, 1647.3766312987013, 1652.3961118831169, 1657.4155924675324, 1662.4350730519482, 1667.4545536363635, 1672.4740342207792, 1677.4935148051948, 1682.5129953896103, 1687.532475974026, 1692.5519565584414, 1697.5714371428571, 1702.5909177272727, 1707.6103983116882, 1712.629878896104, 1717.6493594805195, 1722.668840064935, 1727.6883206493508, 1732.707801233766, 1737.7272818181818, 1742.7467624025974, 1747.766242987013, 1752.7857235714287, 1757.805204155844, 1762.8246847402597, 1767.8441653246753, 1772.8636459090908, 1777.8831264935066, 1782.902607077922, 1787.9220876623376, 1792.9415682467531, 1797.9610488311687, 1802.9805294155844]],
        seriesLabels: ["DEM_watershed"],
        xAxisLabel: "% Area Above",
        yAxisLabel: "Elevation",
        width: 600,
        height: 500,
        drawPoints: false,
        drawGridlines: true,
        drawLegend: false,
        drawGreyBackground: false,
        parentId: "graph"
      };
      function update(svg) {
        // which of the series labels is longest?
        var maxSeriesLabelLength = 0;
        var a;
        for (a = 0; a < plot.seriesLabels.length; a++) {
          var sl = plot.seriesLabels[a];
          if (sl.length > maxSeriesLabelLength) { maxSeriesLabelLength = sl.length; }
        }
        var plotLeftMargin = 70.0;
        var plotRightMargin = plot.drawLegend ? 65.0 + maxSeriesLabelLength * 7 : 50.0;
        var plotBottomMargin = 70.0;
        var plotTopMargin = 40.0;
        var plotWidth = plot.width - plotLeftMargin - plotRightMargin;
        var plotHeight = plot.height - plotBottomMargin - plotTopMargin;
        var originX = plotLeftMargin;
        var originY = plotTopMargin + plotHeight;
        var tickLen = 8.0;
        var minorTickLen = tickLen * 0.65;

        // If there are no series labels, treat it as one series.
        if (plot.seriesLabels.length === 0) {
					plot.drawLegend = false;
				}

        // colors
        var lineColor = '#47a3ff'; //'#377eb8'; // '#729ece'; // '#1f77b4'; //'#47a3ff'; //'rgb(2,145,205)';
        var highlightColor = '#ff7f00';
        var btnColor = 'rgb(170,170,170)';
        var btnHoverColor = 'rgb(150,150,150)';
        var plotBackgroundColor = 'rgb(255,255,255)';
        if (plot.drawGreyBackground) {
          plotBackgroundColor = '#CCC';
        }
        var chartBackgroundColor = 'white';
        // var gridLineColor = 'rgb(120,120,120)';
        // if (plot.drawGreyBackground) {
          var gridLineColor = '#EEE';
        // }
        var trendlineColor = 'DimGray';
        if (plot.drawGreyBackground) {
          trendlineColor = 'DimGray';
        }
        var showValueClr = "black";
        // if (plot.drawGreyBackground) {
        //   showValueClr = '#FFF';
        // }

        // Gridlines
        // var gridlineDash = '1, 5';
        // if (plot.drawGreyBackground) {
          var gridlineDash = 'none';
        // }

        var tableau20 = [[31, 119, 180], [255, 127, 14],
             [44, 160, 44], [214, 39, 40],
             [148, 103, 189], [140, 86, 75],
             [227, 119, 194], [127, 127, 127],
             [188, 189, 34], [23, 190, 207]];

        var regularOpacity = 1.0;
        var deselectedOpacity = 0.10;


        // create the svg element
        var svgns = "http://www.w3.org/2000/svg";
        if (svg == null) {
          svg = document.createElementNS(svgns, "svg");
        } else {
          while (svg.lastChild) {
              svg.removeChild(svg.lastChild);
          }
        }
        svg.setAttribute('width', `${plot.width}`);
        svg.setAttribute('height', `${plot.height}`);
        var div = document.getElementById(plot.parentId);
        if (div != null) {
          div.appendChild(svg);
        } else {
          // add it to the body of the document
          document.querySelector("body").appendChild(svg);
        }

        // how many series are there?
        var numSeries = plot.dataY.length;

        // if dataX is empty, fill it with the series 1, 2, 3, 4, ...
        if (plot.dataX.length == 0) {
          for (s = 0; s < numSeries; s++) {
            var seriesXData = [];
            for (a = 0; a < plot.dataY[s].length; a++) {
              seriesXData.push(a + 1);
            }
            plot.dataX.push(seriesXData);
          }
        }

        // style
        var style = document.createElement("style");
        let styleString = `
        text {
          font-family:Sans,Arial;
        }
        .axisLabel {
          font-weight: normal;
        }
        .xTickLabel {
          fill: black;
          font-size: 85%;
          font-weight: lighter;
        }
        .yTickLabel {
          fill: black;
          font-size: 85%;
          font-weight: lighter;
        }
        .gridLine {
          stroke: ${gridLineColor};
          stroke-dasharray: ${gridlineDash};
          stroke-width: 0.8;
        }
        .tick {
          stroke: black;
          stroke-width: 0.5;
        }
        #plotBorder {
          fill: none;
          stroke: black;
          stroke-width: 0.5;
        }
        #showValue {
          font-size: 85%;
          fill: ${showValueClr};
        }
        #context-menu {
          position:absolute;
          display:none;
        }
        #context-menu ul {
          list-style:none;
          margin:0;
          padding:0;
          background: #EFEFEF;
          opacity: 0.90;
        }
        #context-menu {
          border:solid 1px #CCC;
        }
        #context-menu li {
          font-family:Sans,Arial;
          font-size: 75%;
          text-align: left;
          color:#000;
          display:block;
          padding:5px 15px;
          border-bottom:solid 1px #CCC;
        }
        #context-menu li:last-child {
          border:none;
        }
        #context-menu li:hover {
          background:#007AFF;
          color:#FFF;
        }
        `;

        var dataPointHoverWidth = 4.0;
        if (!plot.drawPoints) {
          dataPointHoverWidth = 6.0;
        }
        var s;
        for (s = 0; s < numSeries; s++) {
          var clrNum = s % tableau20.length;
          if (plot.seriesLabels.length === 0) {
            // If there are no series labels, treat it as one series.
						clrNum = 0;
					}
          let clr = `rgb(${tableau20[clrNum][0]},${tableau20[clrNum][1]},${tableau20[clrNum][2]})`;

          styleString += `
          .seriesLine${s} {
            fill: none;
            stroke-width:1;
            stroke: ${clr};
            opacity: ${regularOpacity};
          }
          .seriesLine${s}:hover {
            fill: none;
            stroke-width:2;
            stroke: ${clr};
            opacity: ${regularOpacity};
          }
          .seriesLineThick${s} {
            fill: none;
            stroke-width:2;
            stroke: ${clr};
            opacity: ${regularOpacity};
          }
          .seriesLineThick${s}:hover {
            fill: none;
            stroke-width:3;
            stroke: ${clr};
            opacity: ${regularOpacity};
          }
          .dataPoint${s} {
            fill: ${clr};
            stroke-width:0;
            stroke: ${clr};
            opacity: ${regularOpacity};
          }
          .dataPoint${s}:hover {
            fill: red;
            stroke-width:${dataPointHoverWidth};
            stroke: red;
            opacity:1.0;
          }
          `;
        }
        style.innerHTML = styleString;
        svg.appendChild(style);
        svg.id = "plotSvg";

        // background
        var background = document.createElementNS(svgns, "rect");
        background.setAttribute('width', plot.width);
        background.setAttribute('height', plot.height);
        background.style.fill = chartBackgroundColor;
        svg.appendChild(background);

        // translate the origin point
        var g = document.createElementNS(svgns, "g");
        g.setAttribute('id', 'transform');
        g.setAttribute('transform', `translate(${originX},${originY})`);
        svg.appendChild(g);

        // plot background
        var plotBackground = document.createElementNS(svgns, "rect");
        plotBackground.setAttribute('id', 'plotBackground');
        plotBackground.setAttribute('x', 0.0);
        plotBackground.setAttribute('y', -plotHeight);
        plotBackground.setAttribute('width', plotWidth);
        plotBackground.setAttribute('height', plotHeight);
        plotBackground.style.fill = plotBackgroundColor;
        plotBackground.style.stroke = "none";
        g.appendChild(plotBackground);

        // what are the min/max values?
        var xMin = Infinity;
        var xMax = -Infinity;
        var yMin = Infinity;
        var yMax = -Infinity;
        var val = 0;
        var maxNumPoints = 0;
        var totalNumPoints = 0;
        for (s = 0; s < numSeries; s++) {
          var numPoints = Math.min(plot.dataX[s].length, plot.dataY[s].length);
          if (numPoints > maxNumPoints) { maxNumPoints = maxNumPoints; }
          totalNumPoints += numPoints;
          if (numPoints < 2) {
            alert("Too few points for line graph");
            return;
          }
          if (plot.dataX[s].length != plot.dataY[s].length) {
            alert("The x and y data arrays are unequal in length.");
          }
          for (a = 0; a < numPoints; a++) {
              val = plot.dataX[s][a];
              if (val < xMin) { xMin = val; }
              if (val > xMax) { xMax = val; }
              val = plot.dataY[s][a];
              if (val < yMin) { yMin = val; }
              if (val > yMax) { yMax = val; }
          }
        }

        // We don't want a data point to fall on the plot border
        xMin -= 0.0000001;
        yMin -= 0.0000001;
        xMax += 0.0000001;
        yMax += 0.0000001;

        // X axis
        var xAxisTickSpacing = 0.0000001;
        var xAxisNumTicks = 1000;
        var xRange = xMax - xMin;
        a = 0;
        while (xAxisNumTicks > 20) {
          if (a % 2 == 0) {
            xAxisTickSpacing *= 5.0;
          } else {
            xAxisTickSpacing *= 2.0;
          }
          a++;
          xAxisNumTicks = Math.ceil(xRange / xAxisTickSpacing);
        }
        xMin = Math.floor(xMin / xAxisTickSpacing) * xAxisTickSpacing;
        xAxisNumTicks = Math.ceil((xMax - xMin) / xAxisTickSpacing);
        xRange = xAxisTickSpacing * xAxisNumTicks;
        var xSigDigits = Math.min(decimalPlaces(xMin+xAxisTickSpacing), decimalPlaces(xMin+2*xAxisTickSpacing)); //Math.round(0.1 / xAxisTickSpacing);
        var dominantTick = 0;
        if (decimalPlaces(xMin) > decimalPlaces(xMin+xAxisTickSpacing)) {
          dominantTick = 1;
        }
        for (a = 0; a <= xAxisNumTicks; a++) {
            // grid line
            if (plot.drawGridlines) {
              if (xAxisNumTicks <= 10 || a % 2 == dominantTick) {
                if (a > 0 && a < xAxisNumTicks) {
                  var line = document.createElementNS(svgns, "line");
                  line.setAttribute('x1', (a * xAxisTickSpacing) / xRange * plotWidth);
                  line.setAttribute('y1', 0);
                  line.setAttribute('x2', (a * xAxisTickSpacing) / xRange * plotWidth);
                  line.setAttribute('y2', -plotHeight);
                  line.setAttribute('class', 'gridLine');
                  g.appendChild(line);
                }
              }
            }
            // tick mark
            var line = document.createElementNS(svgns, "line");
            line.setAttribute('x1', (a * xAxisTickSpacing) / xRange * plotWidth);
            line.setAttribute('y1', 0);
            line.setAttribute('x2', (a * xAxisTickSpacing) / xRange * plotWidth);
            if (xAxisNumTicks <= 10 || a % 2 == dominantTick) {
              line.setAttribute('y2', tickLen);
            } else {
              line.setAttribute('y2', minorTickLen);
            }
            line.setAttribute('class', 'tick');
            g.appendChild(line);

            // labels
            if (xAxisNumTicks <= 10 || a % 2 == dominantTick) {
                // tick label
                var label = document.createElementNS(svgns, "text");
                label.setAttribute('x', (a * xAxisTickSpacing) / xRange * plotWidth);
                label.setAttribute('y', tickLen + 5);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('dominant-baseline', 'hanging');
                label.setAttribute('class', 'xTickLabel');
                label.innerHTML = `${(xMin + a * xAxisTickSpacing).toFixed(xSigDigits)}`;
                g.appendChild(label);
            }
        }

        // Y axis
        var yAxisTickSpacing = 0.0000001;
        var yAxisNumTicks = 1000;
        var yRange = yMax - yMin;
        a = 0;
        while (yAxisNumTicks > 20) {
          if (a % 2 == 0) {
            yAxisTickSpacing *= 5.0;
          } else {
            yAxisTickSpacing *= 2.0;
          }
          a++;
          yAxisNumTicks = Math.ceil(yRange / yAxisTickSpacing);
        }
        yMin = Math.floor(yMin / yAxisTickSpacing) * yAxisTickSpacing;
        yAxisNumTicks = Math.ceil((yMax - yMin) / yAxisTickSpacing);
        yRange = yAxisTickSpacing * yAxisNumTicks;
        var ySigDigits = Math.min(decimalPlaces(yMin+yAxisTickSpacing), decimalPlaces(yMin+2*yAxisTickSpacing));
        dominantTick = 0;
        if (decimalPlaces(yMin) > decimalPlaces(yMin+yAxisTickSpacing)) {
          dominantTick = 1;
        }
        for (a = 0; a <= yAxisNumTicks; a++) {
            // grid line
            if (plot.drawGridlines) {
              if (yAxisNumTicks <= 10 || a % 2 == dominantTick) {
                if (a > 0 && a < yAxisNumTicks) {
                  var line = document.createElementNS(svgns, "line");
                  line.setAttribute('x1', 0); //(a * xAxisTickSpacing) / xRange * plotWidth);
                  line.setAttribute('y1', -(a * yAxisTickSpacing) / yRange * plotHeight);
                  line.setAttribute('x2', plotWidth); //(a * xAxisTickSpacing) / xRange * plotWidth);
                  line.setAttribute('y2', -(a * yAxisTickSpacing) / yRange * plotHeight); //-plotHeight);
                  line.setAttribute('class', 'gridLine');
                  g.appendChild(line);
                }
              }
            }
            // tick mark
            var line = document.createElementNS(svgns, "line");
            line.setAttribute('x1', 0);
            line.setAttribute('y1', -(a * yAxisTickSpacing) / yRange * plotHeight);
            if (yAxisNumTicks <= 6 || a % 2 == dominantTick) {
              line.setAttribute('x2', -tickLen);
            } else {
              line.setAttribute('x2', -minorTickLen);
            }
            line.setAttribute('y2', -(a * yAxisTickSpacing) / yRange * plotHeight);
            line.setAttribute('class', 'tick');
            g.appendChild(line);

            // labels
            if (yAxisNumTicks <= 6 || a % 2 == dominantTick) {
                // s += `<text transform="translate(${-tickLen - 5}, ${-(a * yAxisTickSpacing) / maxVal * plotHeight}), rotate(270)" x="0" y="0" text-anchor="middle" dominant-baseline="no-change" class="yTickLabel">${(a * yAxisTickSpacing).toFixed(ySigDigits)}</text>`;
                var label = document.createElementNS(svgns, "text");
                label.setAttribute('transform', `translate(${-tickLen - 5},${-(a * yAxisTickSpacing) / yRange * plotHeight}), rotate(270)`);
                label.setAttribute('x', 0);
                label.setAttribute('y', 0);
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('dominant-baseline', 'no-change');
                label.setAttribute('class', 'yTickLabel');
                label.innerHTML = `${(yMin + a * yAxisTickSpacing).toFixed(ySigDigits)}`;
                g.appendChild(label);
            }
        }

        // axis labels
        var xLabel = document.createElementNS(svgns, "text");
        xLabel.setAttribute('x', plotWidth / 2.0);
        xLabel.setAttribute('y', tickLen + 25.0);
        xLabel.setAttribute('text-anchor', 'middle');
        xLabel.setAttribute('dominant-baseline', 'hanging');
        xLabel.setAttribute('class', 'axisLabel');
        xLabel.innerHTML = plot.xAxisLabel;
        g.appendChild(xLabel);

        var yLabel = document.createElementNS(svgns, "text");
        yLabel.setAttribute('transform', `translate(${-tickLen - 28.0},${-plotHeight / 2.0}), rotate(270)`);
        yLabel.setAttribute('x', 0);
        yLabel.setAttribute('y', 0);
        yLabel.setAttribute('text-anchor', 'middle');
        yLabel.setAttribute('class', 'axisLabel');
        yLabel.innerHTML = plot.yAxisLabel;
        g.appendChild(yLabel);

        // text to show values when hover over
        var showValue = document.createElementNS(svgns, "text");
        showValue.setAttribute('x', 10);
        showValue.setAttribute('text-anchor', 'start');

        // draw the line(s)
        var g2 = document.createElementNS(svgns, "g");
        g2.setAttribute('id', 'lines');
        g.appendChild(g2);

        var radius = 3.0;
        if (totalNumPoints > 15) { radius = 2.5; }
        if (!plot.drawPoints) {
          radius = 1.0;
        }
        for (let s = 0; s < numSeries; s++) {
          var numPoints = Math.min(plot.dataX[s].length, plot.dataY[s].length);
          let seriesLine = document.createElementNS(svgns, "polyline");
          var pointsString = `${(plot.dataX[s][0] - xMin) / xRange * plotWidth},${-(plot.dataY[s][0] - yMin) / yRange * plotHeight}`;
          for (let a = 1; a < numPoints; a++) {
            pointsString += ` ${(plot.dataX[s][a] - xMin) / xRange * plotWidth},${-(plot.dataY[s][a] - yMin) / yRange * plotHeight}`
          }
          seriesLine.setAttribute('points', pointsString);
          var seriesLabel = "seriesLine";
          if (!plot.drawPoints) { seriesLabel = "seriesLineThick"; }
          seriesLine.setAttribute('class', `${seriesLabel}${s}`);
          seriesLine.addEventListener('mouseover', function() {
            var s2;
            for (s2 = 0; s2 < numSeries; s2++) {
              if (s2 != s) {
                var x = document.getElementsByClassName(`${seriesLabel}${s2}`);
                var i;
                for (i = 0; i < x.length; i++) {
                  x[i].style.opacity = deselectedOpacity;
                }
                x = document.getElementsByClassName(`dataPoint${s2}`);
                for (i = 0; i < x.length; i++) {
                    x[i].style.opacity = deselectedOpacity;
                }
              }
            }
          }, false);
          seriesLine.addEventListener('mouseout', function() {
            var s2;
            for (s2 = 0; s2 < numSeries; s2++) {
              if (s2 != s) {
                var x = document.getElementsByClassName(`${seriesLabel}${s2}`);
                var i;
                for (i = 0; i < x.length; i++) {
                  x[i].style.opacity = regularOpacity;
                }
                x = document.getElementsByClassName(`dataPoint${s2}`);
                for (i = 0; i < x.length; i++) {
                    x[i].style.opacity = regularOpacity;
                }
              }
            }
          }, false);
          g2.appendChild(seriesLine);

          // draw the data points
          for (let a = 0; a < numPoints; a++) {
            let c = document.createElementNS(svgns, "circle");
            c.setAttribute('cx', `${(plot.dataX[s][a] - xMin) / xRange * plotWidth}`);
            c.setAttribute('cy', `${-(plot.dataY[s][a] - yMin) / yRange * plotHeight}`);
            c.setAttribute('r', radius);
            c.setAttribute('class', `dataPoint${s}`);
            c.addEventListener('mouseover', function() {
              var s2;
              for (s2 = 0; s2 < numSeries; s2++) {
                if (s2 != s) {
                  var x = document.getElementsByClassName(`${seriesLabel}${s2}`);
                  var i;
                  for (i = 0; i < x.length; i++) {
                    x[i].style.opacity = deselectedOpacity;
                  }
                  x = document.getElementsByClassName(`dataPoint${s2}`);
                  for (i = 0; i < x.length; i++) {
                      x[i].style.opacity = deselectedOpacity;
                  }
                }
              }
              showValue.innerHTML = `x: ${(plot.dataX[s][a]).toFixed(xSigDigits+2)}, y: ${(plot.dataY[s][a]).toFixed(ySigDigits+2)}`;
            }, false);
            c.addEventListener('mouseout', function() {
              var s2;
              for (s2 = 0; s2 < numSeries; s2++) {
                if (s2 != s) {
                  var x = document.getElementsByClassName(`${seriesLabel}${s2}`);
                  var i;
                  for (i = 0; i < x.length; i++) {
                    x[i].style.opacity = regularOpacity;
                  }
                  x = document.getElementsByClassName(`dataPoint${s2}`);
                  for (i = 0; i < x.length; i++) {
                      x[i].style.opacity = regularOpacity;
                  }
                }
              }
              showValue.innerHTML = "";
            }, false);
            g2.appendChild(c);
          }
        }

        // Show value label
        showValue.setAttribute('id', 'showValue');
        showValue.setAttribute('y', -plotHeight + 20);
        g.appendChild(showValue);

        // plot border
        var plotBorder = document.createElementNS(svgns, "rect");
        plotBorder.setAttribute('x', 0);
        plotBorder.setAttribute('y', -plotHeight);
        plotBorder.setAttribute('width', plotWidth);
        plotBorder.setAttribute('height', plotHeight);
        plotBorder.id = "plotBorder";
        g.appendChild(plotBorder);

        // add a legend
        if (plot.seriesLabels.length > 0 && plot.drawLegend) {
          var legend = document.createElementNS(svgns, "g");
          legend.setAttribute('id', 'legend');
          g.appendChild(legend);
          for (let s = 0; s < numSeries; s++) {
            var y = -(plotHeight - 35 - 23 * (s+1));
            var line = document.createElementNS(svgns, "line");
            line.setAttribute('x1', plotWidth + 10);
            line.setAttribute('y1', y);
            line.setAttribute('x2', plotWidth + 40);
            line.setAttribute('y2', y);
            if (plot.drawPoints) {
              line.setAttribute('class', `seriesLine${s}`);
            } else {
              line.setAttribute('class', `seriesLineThick${s}`);
            }
            legend.appendChild(line);

            if (plot.drawPoints) {
              var c = document.createElementNS(svgns, "circle");
              c.setAttribute('cx', plotWidth+25);
              c.setAttribute('cy', y);
              c.setAttribute('r', radius);
              c.setAttribute('class', `dataPoint${s}`);
              legend.appendChild(c);
            }

            var legendLabel = document.createElementNS(svgns, "text");
            legendLabel.setAttribute('x', plotWidth + 48);
            legendLabel.setAttribute('y', y);
            legendLabel.setAttribute('text-anchor', 'left');
            // legendLabel.setAttribute('text-anchor', 'middle');
            legendLabel.setAttribute('dominant-baseline', 'middle');
            legendLabel.setAttribute('class', 'xTickLabel');
            legendLabel.innerHTML = plot.seriesLabels[s];
            legend.appendChild(legendLabel);
          }
        }

        // Add an invisible context menu to the parentId.
        var cm = document.createElement('div');
        cm.id = 'context-menu';
        cm.className = 'context-menu';
        var list = document.createElement('ul');

        var copyBtn = document.createElement("li");
        copyBtn.innerHTML = "Copy";
        copyBtn.addEventListener('click', function() {
          var content = `<svg xmlns='${svgns}' width='${plot.width}' height='${plot.height}'>\n${svg.innerHTML}\n</svg>`;
          // Create an auxiliary hidden input
          var aux = document.createElement("input");
          // Get the text from the element passed into the input
          aux.setAttribute("value", content);
          // Append the aux input to the body
          document.body.appendChild(aux);
          // Highlight the content
          aux.select();
          // Execute the copy command
          document.execCommand("copy");
          // Remove the input from the body
          document.body.removeChild(aux);
          // Give a notification
          alert("The plot's SVG content has been copied to the clipboard.");
        }, false);
        list.appendChild(copyBtn);

        var gridlineBtn = document.createElement("li");
        var verb = plot.drawGridlines ? "Hide " : "Show ";
        gridlineBtn.innerHTML = verb + "Gridlines";
        gridlineBtn.addEventListener('click', function() {
          plot.drawGridlines = !plot.drawGridlines;
          // update the context menu label
          var verb = plot.drawGridlines ? "Hide " : "Show ";
          gridlineBtn.innerHTML = verb + "Gridlines";
          update(svg);
        }, false);
        list.appendChild(gridlineBtn);

        if (plot.seriesLabels.length > 0) {
          var legendBtn = document.createElement("li");
          var verb = plot.drawLegend ? "Hide " : "Show ";
          legendBtn.innerHTML = verb + "Legend";
          legendBtn.addEventListener('click', function() {
            plot.drawLegend = !plot.drawLegend;
            // update the context menu label
            var verb = plot.drawLegend ? "Hide " : "Show ";
            legendBtn.innerHTML = verb + "Legend";
            update(svg);
          }, false);
          list.appendChild(legendBtn);
        }

        var pointsBtn = document.createElement("li");
        var verb = plot.drawPoints ? "Hide " : "Show ";
        pointsBtn.innerHTML = verb + "Points";
        pointsBtn.addEventListener('click', function() {
          plot.drawPoints = !plot.drawPoints;
          // update the context menu label
          var verb = plot.drawPoints ? "Hide " : "Show ";
          pointsBtn.innerHTML = verb + "Points";
          update(svg);
        }, false);
        list.appendChild(pointsBtn);

        var backgroundColorBtn = document.createElement("li");
        var verb = plot.drawGreyBackground ? "Light " : "Dark ";
        backgroundColorBtn.innerHTML = verb + "Background";
        backgroundColorBtn.addEventListener('click', function() {
          plot.drawGreyBackground = !plot.drawGreyBackground;
          // update the context menu label
          var verb = plot.drawGreyBackground ? "Light " : "Dark ";
          backgroundColorBtn.innerHTML = verb + "Background";
          update(svg);
        }, false);
        list.appendChild(backgroundColorBtn);

        cm.appendChild(list);
        document.getElementById(plot.parentId).appendChild(cm);

        var menu = document.getElementById('context-menu');
        document.onclick = function () {
            menu.style.display = 'none';
        };

        document.getElementById('plotSvg').oncontextmenu = function (evt) {
            evt = (evt) ? evt : ((event) ? event : null);
            var posnX = (evt.pageX) ? evt.pageX : ((evt.offsetX) ? evt.offsetX + 10 : null);
            var posnY = (evt.pageY) ? evt.pageY : ((evt.offsetY) ? evt.offsetY + 10 : null);
            menu.style.left = posnX + 'px';
            menu.style.top = posnY + 'px';
            menu.style.display = 'block';
            if (typeof evt.preventDefault != "undefined") {
                evt.preventDefault();
            } else {
                evt.returnValue = false;
            }
        };
      }

      function decimalPlaces(num) {
        var match = (''+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);
        if (!match) { return 0; }
        return Math.max(
             0,
             // Number of digits right of decimal point.
             (match[1] ? match[1].length : 0)
             // Adjust for scientific notation.
             - (match[2] ? +match[2] : 0));
      }

      update(null);
    </script></div></body>